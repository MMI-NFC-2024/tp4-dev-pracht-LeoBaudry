---
import Layout from "../../layouts/Layout.astro";
---

<Layout>
  <h1>TP4 - Penguin avec Plusieurs Filtres</h1>
  
  <div style="margin: 20px 0; display: flex; gap: 20px; flex-wrap: wrap;">
    <div>
      <label for="species">Espèce :</label>
      <select name="species" id="species">
        <option value="">All species</option>
        <option value="Adelie">Adelie</option>
        <option value="Chinstrap">Chinstrap</option>
        <option value="Gentoo">Gentoo</option>
      </select>
    </div>
    
    <div>
      <label for="island">Île :</label>
      <select name="island" id="island">
        <option value="">All islands</option>
        <option value="Biscoe">Biscoe</option>
        <option value="Dream">Dream</option>
        <option value="Torgersen">Torgersen</option>
      </select>
    </div>
    
    <div>
      <label for="sex">Sexe :</label>
      <select name="sex" id="sex">
        <option value="">All</option>
        <option value="MALE">Male</option>
        <option value="FEMALE">Female</option>
      </select>
    </div>
  </div>
  
  <div id="penguinplot"></div>
  
  <div id="stats" style="margin-top: 20px; padding: 10px; background-color: #f5f5f5; border-radius: 5px;">
    <h3>Statistiques :</h3>
    <p id="count">Nombre de penguins affichés : <span>0</span></p>
  </div>

  <script>
    import * as Plot from "https://cdn.jsdelivr.net/npm/@observablehq/plot@0.6/+esm";
    import penguins from "../../assets/penguins.json";
    
    const selectSpecies = document.querySelector("#species") as HTMLSelectElement;
    const selectIsland = document.querySelector("#island") as HTMLSelectElement;
    const selectSex = document.querySelector("#sex") as HTMLSelectElement;
    const countSpan = document.querySelector("#count span");
    
    function renderPlot() {
      // Récupère les valeurs sélectionnées
      const species = selectSpecies.value;
      const island = selectIsland.value;
      const sex = selectSex.value;
      
      const plotDiv = document.querySelector("#penguinplot");
      if (!plotDiv) return;
        plotDiv.innerHTML = "";
      
      let filteredPenguins = penguins;
      if (species) {
        filteredPenguins = filteredPenguins.filter(p => p.species === species);
      }
      if (island) {
        filteredPenguins = filteredPenguins.filter(p => p.island === island);
      }
      if (sex) {
        filteredPenguins = filteredPenguins.filter(p => p.sex === sex);
      }
      
      if (countSpan) {
        countSpan.textContent = filteredPenguins.length.toString();
      }
      
      const plot = Plot.plot({
        marks: [
          Plot.dot(filteredPenguins, {
            x: "culmen_length_mm", 
            y: "culmen_depth_mm",  
            stroke: "species",     
            fill: "island",        
            r: 4,                  
          }),
        ],
        color: {
          legend: true
        },
        grid: true,
      });
      plotDiv.append(plot);
    }
    
    selectSpecies.addEventListener("change", renderPlot);
    selectIsland.addEventListener("change", renderPlot);
    selectSex.addEventListener("change", renderPlot);
    
    renderPlot();
  </script>
</Layout>