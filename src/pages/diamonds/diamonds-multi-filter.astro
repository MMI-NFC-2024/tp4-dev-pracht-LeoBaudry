---
import Layout from "../../layouts/Layout.astro";
---

<Layout>
  <h1>ðŸ’Ž Diamonds - Multi-Filtres</h1>
  
  <div style="margin: 20px 0; display: flex; gap: 20px; flex-wrap: wrap;">
    <div>
      <label for="cut">Coupe :</label>
      <select name="cut" id="cut">
        <option value="">Toutes</option>
        <option value="Fair">Fair</option>
        <option value="Good">Good</option>
        <option value="Very Good">Very Good</option>
        <option value="Premium">Premium</option>
        <option value="Ideal">Ideal</option>
      </select>
    </div>
    
    <div>
      <label for="color">Couleur :</label>
      <select name="color" id="color">
        <option value="">Toutes</option>
        <option value="D">D</option>
        <option value="E">E</option>
        <option value="F">F</option>
        <option value="G">G</option>
        <option value="H">H</option>
        <option value="I">I</option>
        <option value="J">J</option>
      </select>
    </div>
    
    <div>
      <label for="clarity">ClartÃ© :</label>
      <select name="clarity" id="clarity">
        <option value="">Toutes</option>
        <option value="I1">I1</option>
        <option value="SI2">SI2</option>
        <option value="SI1">SI1</option>
        <option value="VS2">VS2</option>
        <option value="VS1">VS1</option>
        <option value="VVS2">VVS2</option>
        <option value="VVS1">VVS1</option>
        <option value="IF">IF</option>
      </select>
    </div>
  </div>
  
  <div id="diamondplot"></div>
  
  <div id="stats" style="margin-top: 20px; padding: 10px; background-color: #f5f5f5; border-radius: 5px;">
    <p>Diamants affichÃ©s : <strong id="count">0</strong></p>
  </div>

  <script>
    import * as Plot from "https://cdn.jsdelivr.net/npm/@observablehq/plot@0.6/+esm";
    import diamonds from "../../assets/diamonds.json";
    
    const selectCut = document.querySelector("#cut") as HTMLSelectElement;
    const selectColor = document.querySelector("#color") as HTMLSelectElement;
    const selectClarity = document.querySelector("#clarity") as HTMLSelectElement;
    const countSpan = document.querySelector("#count");
    
    function renderPlot() {
      const cut = selectCut.value;
      const color = selectColor.value;
      const clarity = selectClarity.value;
      
      const plotDiv = document.querySelector("#diamondplot");
      plotDiv.innerHTML = "";
      
      let filteredDiamonds = diamonds;
      
      if (cut) filteredDiamonds = filteredDiamonds.filter(d => d.cut === cut);
      if (color) filteredDiamonds = filteredDiamonds.filter(d => d.color === color);
      if (clarity) filteredDiamonds = filteredDiamonds.filter(d => d.clarity === clarity);
      
      countSpan.textContent = filteredDiamonds.length;
      
      const plot = Plot.plot({
        marks: [
          Plot.dot(filteredDiamonds, {
            x: "carat",
            y: "price",
            stroke: "cut",
            fill: "color",
            r: 2,
            opacity: 0.7,
          }),
        ],
        color: { legend: true },
        grid: true,
      });
      
      plotDiv.append(plot);
    }
    
    selectCut.addEventListener("change", renderPlot);
    selectColor.addEventListener("change", renderPlot);
    selectClarity.addEventListener("change", renderPlot);
    renderPlot();
  </script>
</Layout>